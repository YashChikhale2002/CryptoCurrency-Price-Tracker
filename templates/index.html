<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Price Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-200 text-gray-900">

    <!-- Header -->
    <header class="bg-gradient-to-r from-gray-800 to-teal-500 p-6 shadow-lg">
        <div class="flex justify-between items-center">
            <!-- Logo and Title -->
            <div class="flex items-center">
                <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" alt="Crypto Tracker Logo" class="w-12 h-12 rounded-full mr-4" />
                <div>
                    <h1 class="text-3xl font-bold text-white">Crypto Tracker</h1>
                    <p class="text-sm text-gray-300">Real-time updates powered by Binance API</p>
                </div>
            </div>

            <!-- Navigation Links -->
            <nav class="flex gap-6">
                <a href="#features" class="text-white text-lg font-medium hover:text-teal-200 transition-colors">Features</a>
                <a href="#pricing" class="text-white text-lg font-medium hover:text-teal-200 transition-colors">Pricing</a>
                <a href="#contact" class="text-white text-lg font-medium hover:text-teal-200 transition-colors">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-8">
        <div class="max-w-3xl mx-auto">
            <!-- Currency Selector -->
            <div class="text-center mb-8">
                <label for="currency-selector" class="font-bold text-lg mr-2">Select Currency:</label>
                <select id="currency-selector" class="p-2 text-lg border rounded-md shadow-md bg-white">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="GBP">GBP</option>
                    <option value="JPY">JPY</option>
                </select>
            </div>

            <!-- Price List -->
            <ul class="space-y-4">
                {% for symbol in allowed_symbols %}
                <li id="price-{{ symbol | upper }}" class="flex justify-between items-center bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow">
                    <div class="flex items-center">
                        <img src="
                            {% if symbol == 'btcusdt' %} https://cryptologos.cc/logos/bitcoin-btc-logo.png
                            {% elif symbol == 'ethusdt' %} https://cryptologos.cc/logos/ethereum-eth-logo.png
                            {% elif symbol == 'dogeusdt' %} https://cryptologos.cc/logos/dogecoin-doge-logo.png
                            {% elif symbol == 'bnbusdt' %} https://cryptologos.cc/logos/bnb-bnb-logo.png
                            {% else %} https://cryptologos.cc/logos/{{ symbol | lower }}-{{ symbol | lower }}-logo.png
                            {% endif %}" alt="{{ symbol | upper }}" class="w-12 h-12 rounded-full" />
                        <div class="ml-4">
                            <h4 class="text-xl font-semibold">{{ symbol | upper }}</h4>
                            <p id="change-value-{{ symbol | upper }}" class="text-sm text-gray-500">Change: Loading...</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <h4 id="price-value-{{ symbol | upper }}" class="text-2xl font-bold">Loading...</h4>
                        <p id="volume-value-{{ symbol | upper }}" class="text-sm text-gray-500">Volume: Loading...</p>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-teal-500 to-gray-800 text-white p-8 text-center mt-12 shadow-md rounded-t-lg">
        <p>&copy; 2025 Crypto Tracker | All rights reserved</p>
    </footer>

    <!-- Socket.IO Script -->
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
        const socket = io();
        const currencySelector = document.getElementById("currency-selector");
        let selectedCurrency = "USD";

        socket.on("price_update", (data) => {
            const { symbol, price, volume, change } = data;

            const upperSymbol = symbol.toUpperCase();
            const priceValue = document.getElementById(
                `price-value-${upperSymbol}`
            );
            const volumeValue = document.getElementById(
                `volume-value-${upperSymbol}`
            );
            const changeValue = document.getElementById(
                `change-value-${upperSymbol}`
            );

            if (priceValue && volumeValue && changeValue) {
                fetch(`/convert?amount=${price}&from=USD&to=${selectedCurrency}`)
                    .then((response) => response.json())
                    .then((converted) => {
                        const existingPrice = parseFloat(
                            priceValue.textContent.replace(/[^0-9.-]+/g, "")
                        );
                        const newPrice = converted.converted;

                        priceValue.textContent = `${selectedCurrency} ${newPrice.toFixed(2)}`;
                        volumeValue.textContent = `Volume: ${volume.toFixed(2)}`;
                        changeValue.textContent = `Change: ${change.toFixed(2)}%`;

                        if (existingPrice) {
                            priceValue.classList.remove("text-green-500", "text-red-500");
                            const changeClass = newPrice > existingPrice ? "text-green-500" : "text-red-500";
                            priceValue.classList.add(changeClass);
                        }
                    });
            }
        });

        currencySelector.addEventListener("change", (e) => {
            selectedCurrency = e.target.value;
        });
    </script>
</body>
</html>
